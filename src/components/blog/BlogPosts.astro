---
import PostItem from "./PostItem.astro";
import type { Post } from "@/types";

interface Props {
    limit?: number;
}

const { limit } = Astro.props;

// Construir la URL con parámetros de WordPress REST API
// _embed: incluye datos relacionados (categorías, autor, etc.)
// orderby=date&order=desc: ordena por fecha descendente (más recientes primero)
// per_page: limita la cantidad de resultados
let url = `${import.meta.env.API_URL}/posts?_embed&orderby=date&order=desc`;
if (limit) {
    url += `&per_page=${limit}`;
}

const response = await fetch(url, {
    cache: "no-store",
    headers: {
        "Cache-Control": "no-cache, no-store, must-revalidate",
        Pragma: "no-cache",
        Expires: "0",
    },
});
const json = await response.json();
const posts: Post[] = json;
---

{
    posts.map((post, index) => (
        <>
            <PostItem post={post} />
            {index < posts.length - 1 && (
                <div class="my-12 flex items-center">
                    <div
                        aria-hidden="true"
                        class="w-full border-t border-zinc-300/20"
                    />
                    <div class="relative flex justify-center">
                        <span class="bg-slate-900 px-2 text-sm text-zinc-500">
                            Continue
                        </span>
                    </div>
                    <div
                        aria-hidden="true"
                        class="w-full border-t border-zinc-300/20"
                    />
                </div>
            )}
        </>
    ))
}
